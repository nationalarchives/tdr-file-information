def versionTag = "v${env.BUILD_NUMBER}"

pipeline {
  agent none

  parameters {
    choice(name: "VERSION", choices: ["patch", "minor", "major"], description: "The stage you are building the front end for")
  }
  stages {
    stage("Publish package") {
        agent {
            ecs {
                inheritFrom "npm"
            }
        }
        
        steps {
            checkout scm
            sh 'npm ci'
            sh 'npm run build:prod'
            withCredentials([string(credentialsId: 'npm-login', variable: 'LOGIN_TOKEN')]) {
                sh "npm version $VERSION"
                sh "npm config set //registry.npmjs.org/:_authToken=$LOGIN_TOKEN"
                sh 'npm publish --access public'
            }
        }
    }
  }
}
