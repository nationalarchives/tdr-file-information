library("tdr-jenkinslib")

def repo = "tdr-file-metadata"

pipeline {
  agent none

  stages {
    stage("Publish package") {
        agent {
            ecs {
                inheritFrom "npm"
            }
        }
        steps {
            script {
                tdr.reportStartOfBuildToGitHub(repo)
            }
            checkout scm
            sh 'npm ci'
            sh 'npm test'
	        sh 'npm run lint'
        }
    }
  }
  post {
          failure {
            node('master') {
              script {
                tdr.reportFailedBuildToGitHub(repo)
              }
            }
          }
          success {
            node('master') {
              script {
                tdr.reportSuccessfulBuildToGitHub(repo)
              }
            }
          }
      }
}
